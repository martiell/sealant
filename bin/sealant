#!/bin/sh -e

tmp="$PWD"
cd $(dirname $0)
file="$0"
while file=$(readlink "$file"); do
  cd $(dirname "$file")
done
dir=$(pwd)/..
cd "$tmp"

unset $(env | grep ^npm | cut -d= -f1)
TMP=$(mktemp -d /tmp/shrinkwrap-XXXXXX)
trap "rm -r \"$TMP\"" 0
cd "$TMP"
ln -s "$OLDPWD/package.json"
ln -s "$OLDPWD/node_modules"
ln -s "$dir/src/sealant.js"
NODE_PATH=/usr/local/lib/node_modules ./sealant.js "$@"
cp npm-shrinkwrap.json "$OLDPWD"
